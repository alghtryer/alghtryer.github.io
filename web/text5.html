<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>URL Text & OG Extractor</title>

<style>
body{font-family:Arial;max-width:900px;margin:auto;padding:20px;background:#f5f5f5}
.card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-bottom:20px}
input,button{width:100%;padding:12px;margin-top:10px;font-size:16px;border-radius:8px;border:1px solid #ccc}
button{cursor:pointer;font-weight:bold}
.preview{border:1px solid #ddd;padding:15px;border-radius:8px;margin-top:10px;line-height:1.6}
.copyBtn{background:#111;color:#fff;border:none;margin-top:8px}
textarea{width:100%;min-height:200px;margin-top:10px}
</style>
</head>

<body>

<div class="card">

<h2>URL Extractor</h2>

<input id="urlInput" placeholder="RUČNI URL">
<button onclick="loadManual()">Učitaj ovaj URL</button>

<hr>

<input id="count" type="number" value="5">
<button onclick="loadAuto()">Uzmi X tekstova sa bloga</button>

<div id="result"></div>

</div>


<script>

// =======================
// ⭐ ULTRA STABLE FETCH
// =======================

async function fetchHTML(url){

const proxies=[

u=>`https://corsproxy.io/?${encodeURIComponent(u)}`,
u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
u=>`https://thingproxy.freeboard.io/fetch/${u}`

];

for(const p of proxies){
try{
const r=await fetch(p(url),{cache:"no-store"});
const t=await r.text();
if(t && t.length>800) return t;
}catch(e){}
}

// retry once
await new Promise(r=>setTimeout(r,1200));

for(const p of proxies){
try{
const r=await fetch(p(url));
const t=await r.text();
if(t && t.length>800) return t;
}catch(e){}
}

throw "FETCH FAILED";

}



// =======================
// NORMALIZE URL
// =======================

function normalize(url){
return url.replace(/\/$/,'').split('?')[0];
}



// =======================
// CLEAN CONTENT
// =======================

function cleanHTML(html){

const parser=new DOMParser();
const doc=parser.parseFromString(html,'text/html');

const ogTitle = doc.querySelector('meta[property="og:title"]')?.content || doc.title || '';
const ogImage = doc.querySelector('meta[property="og:image"]')?.content || '';

let contentDiv =
doc.querySelector('.post-body.entry-content.float-container')
|| doc.querySelector('.post-body')
|| doc.querySelector('.entry-content')
|| doc.querySelector('article');

if(!contentDiv) return {ogTitle,ogImage,html:"Nije pronađen content div"};

const container=document.createElement('div');
container.innerHTML=contentDiv.innerHTML;

// remove junk
container.querySelectorAll('script,style,iframe,ins,.adsbygoogle').forEach(e=>e.remove());

let finalHTML=container.innerHTML;

// cut at ad text
const stop=/Tekst se nastavlja ispod oglasa/i;
if(stop.test(finalHTML)){
finalHTML=finalHTML.split(stop)[0];
}

return {ogTitle,ogImage,html:finalHTML};

}



// =======================
// COPY
// =======================

function copyText(text){
navigator.clipboard.writeText(text);
}



// =======================
// RENDER RESULT
// =======================

function render(url,data){

const box=document.createElement('div');
box.className="card";

box.innerHTML=`

<b>URL:</b>
<input value="${url}">
<button class="copyBtn" onclick="copyText('${url}')">Copy URL</button>

<b>Naslov:</b>
<input value="${data.ogTitle.replace(/"/g,'&quot;')}">
<button class="copyBtn" onclick="copyText(\`${data.ogTitle}\`)">Copy naslov</button>

${data.ogImage?`<img src="${data.ogImage}" style="max-width:100%">`:''}
${data.ogImage?`<button class="copyBtn" onclick="copyText('${data.ogImage}')">Copy image URL</button>`:''}

<b>Preview:</b>
<div class="preview">${data.html}</div>

<button class="copyBtn" onclick="copyText(\`${data.html.replace(/`/g,"")}\`)">
Copy HTML
</button>

<button class="copyBtn" onclick="copyText(\`${data.html.replace(/<[^>]+>/g,'').replace(/`/g,"")}\`)">
Copy TEXT
</button>

<textarea>${data.html.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</textarea>

`;

document.getElementById('result').appendChild(box);

}



// =======================
// MANUAL LOAD
// =======================

async function loadManual(){

const url=document.getElementById('urlInput').value.trim();
if(!url) return;

try{
const html=await fetchHTML(url);
render(url,cleanHTML(html));
}catch(e){
alert("Ne mogu učitati URL");
}

}



// =======================
// AUTO BLOG LOAD
// =======================

async function loadAuto(){

document.getElementById('result').innerHTML="";

const max=document.getElementById('count').value;

try{

const feed=await fetchHTML("https://www.zanimljivosti.xyz/feeds/posts/default?alt=json");

const j=JSON.parse(feed);

const used=new Set();

let added=0;

for(const post of j.feed.entry){

if(added>=max) break;

const link=post.link.find(l=>l.rel==="alternate").href;

const n=normalize(link);

if(used.has(n)) continue;

used.add(n);

try{

const html=await fetchHTML(link);

render(link,cleanHTML(html));

added++;

await new Promise(r=>setTimeout(r,900));

}catch(e){}

}

}catch(e){

alert("Feed nije dostupan");

}

}

</script>

</body>
</html>