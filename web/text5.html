<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>URL Text & OG Extractor</title>

<style>
body{font-family:Arial,sans-serif;max-width:900px;margin:auto;padding:20px;background:#f5f5f5}
.card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-top:20px}
input,button{width:100%;padding:12px;margin-top:10px;font-size:16px;border-radius:8px;border:1px solid #ccc}
button{cursor:pointer;font-weight:bold}
.label{font-weight:bold;margin-top:15px;display:block}
.preview{border:1px solid #ddd;padding:15px;border-radius:8px;margin-top:10px;line-height:1.6}
.copyBtn{background:#111;color:#fff;border:none;margin-top:8px}
</style>
</head>

<body>

<div class="card">
<h2>URL Extractor (Text + OG Title + OG Image)</h2>

<label><input type="radio" name="mode" value="manual" checked> Manual URL</label>
<label><input type="radio" name="mode" value="auto"> Auto ‚Äì zanimljivosti.xyz</label>

<input id="urlInput" placeholder="Zalijepi URL...">
<input id="countInput" type="number" placeholder="Broj tekstova (npr. 5)" style="display:none">

<button onclick="loadData()">Uƒçitaj sadr≈æaj</button>

<div id="result"></div>
</div>

<script>

// ========================
// ‚≠ê ULTRA FETCH (3 proxy + retry)
// ========================

async function fetchHTML(url){

const proxies=[
u=>`https://corsproxy.io/?${encodeURIComponent(u)}`,
u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
u=>`https://thingproxy.freeboard.io/fetch/${u}`
];

for(const p of proxies){
try{
const r=await fetch(p(url),{cache:"no-store"});
const t=await r.text();
if(t && t.length>800) return t;
}catch(e){}
}

// retry once
await new Promise(r=>setTimeout(r,1200));

for(const p of proxies){
try{
const r=await fetch(p(url));
const t=await r.text();
if(t && t.length>800) return t;
}catch(e){}
}

throw "FETCH FAIL";
}


// ========================

const endings=[
"NASTAVAK PRIƒåE U KOMENTARU üëáüëáüëá",
"ƒåITAJ dalje u komentaru üëáüëáüëá",
"OSTATAK PRICE PROCITAJTE NA LINKU U KOMENTARU ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è",
"NASTAVAK U KOMENTARU üëáüëáüëá",
"ƒåITAJTE NA LINKU U KOMENTARU üëáüëáüëá"
];

let postCounter=0;

document.querySelectorAll('input[name="mode"]').forEach(r=>{
r.addEventListener("change",()=>{
urlInput.style.display=r.value==="manual"?"block":"none";
countInput.style.display=r.value==="auto"?"block":"none";
});
});


// ========================
// LOAD DATA
// ========================

async function loadData(){

result.innerHTML="";
const mode=document.querySelector('input[name="mode"]:checked').value;

if(mode==="manual"){
const url=urlInput.value.trim();
if(!url) return alert("Unesi URL");
await processSingle(url);
}

if(mode==="auto"){

const count=parseInt(countInput.value);
if(!count) return alert("Unesi broj tekstova");

try{

// ‚≠ê poku≈°aj homepage
let html;

try{
html=await fetchHTML("https://www.zanimljivosti.xyz/");
}catch(e){
// fallback feed ako homepage blokira
html=await fetchHTML("https://www.zanimljivosti.xyz/feeds/posts/default?alt=json");

const j=JSON.parse(html);

let links=j.feed.entry.map(p=>p.link.find(l=>l.rel==="alternate").href);
links=[...new Set(links)].slice(0,count);

for(let link of links){
await processSingle(link);
}

return;
}

const doc=new DOMParser().parseFromString(html,'text/html');

let links=[...doc.querySelectorAll('a')]
.map(a=>a.href)
.filter(h=>/^https:\/\/www\.zanimljivosti\.xyz\/202\d\/\d{2}\//.test(h))
.map(normalizeURL)
.filter(Boolean);

links=[...new Set(links)];
links=links.slice(0,count);

for(let link of links){
await processSingle(link);
}

}catch(e){
alert("Ne mogu uƒçitati blog trenutno");
}

}
}


// ========================
// NORMALIZE
// ========================

function normalizeURL(url){
try{
const u=new URL(url);
let clean=u.origin+u.pathname;
clean=clean.replace(/\/$/,'');
return clean;
}catch(e){return null;}
}


// ========================
// PROCESS SINGLE
// ========================

async function processSingle(url){

const html=await fetchHTML(url);
const doc=new DOMParser().parseFromString(html,'text/html');

const ogTitle=doc.querySelector('meta[property="og:title"]')?.content||doc.title||'';
const ogImage=doc.querySelector('meta[property="og:image"]')?.content||'';

let contentDiv=doc.querySelector('.post-body.entry-content.float-container')
||doc.querySelector('.entry-content')
||doc.querySelector('article');

let finalHTML='';

if(contentDiv){

function takeUntilStop(node){
const fragment=document.createDocumentFragment();
let stop=false;

function recurse(current,parent){

if(stop) return;

if(current.nodeType===8 && current.nodeValue.includes('STOP TEXT HERE')){
stop=true;
return;
}

const clone=current.cloneNode(false);
parent.appendChild(clone);

current.childNodes.forEach(child=>{
if(!stop) recurse(child,clone);
});
}

node.childNodes.forEach(child=>recurse(child,fragment));
return fragment;
}

const container=document.createElement('div');
container.appendChild(takeUntilStop(contentDiv));

container.querySelectorAll('script,style,iframe,ins,.adsbygoogle').forEach(e=>e.remove());

finalHTML=container.innerHTML;
finalHTML=finalHTML.replace(/-\s*-\s*-\s*Tekst se nastavlja ispod oglasa\s*-\s*-\s*-/gi,'');

const endMsg=endings[Math.floor(Math.random()*endings.length)];
finalHTML+=`<p><strong>${endMsg}</strong></p>`;
}
else{
finalHTML="<i>Nije pronaƒëen tekst</i>";
}

const box=document.createElement("div");
box.className="card";

const previewID=`preview-${postCounter}`;
const htmlID=`html-${postCounter}`;
postCounter++;

box.innerHTML=`
<span class='label'>URL:</span>
<input value="${url}">
<button class='copyBtn' onclick="copyRaw('${url}')">Copy URL</button>

<span class='label'>OG Naslov:</span>
<input value="${ogTitle.replace(/"/g,'&quot;')}">
<button class='copyBtn' onclick="copyRaw('${ogTitle.replace(/"/g,'&quot;')}')">Copy naslov</button>

<span class='label'>OG Slika:</span>
${ogImage?`<img src="${ogImage}" style="max-width:100%">`:''}
${ogImage?`<button class='copyBtn' onclick="copyRaw('${ogImage}')">Copy image URL</button>`:''}

<span class='label'>Preview (plain text):</span>
<div class='preview' id='${previewID}'>${finalHTML}</div>
<button class='copyBtn' onclick="copyHTML('${previewID}')">Copy tekst (plain)</button>

<span class='label'>HTML tekst:</span>
<textarea id='${htmlID}'>${finalHTML.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</textarea>
<button class='copyBtn' onclick="copyHTML('${htmlID}')">Copy raw HTML</button>
`;

result.appendChild(box);
}


// ========================
// COPY
// ========================

function copyRaw(text){
navigator.clipboard.writeText(text);
}

function copyHTML(id){
const el=document.getElementById(id);
if(el.tagName==='TEXTAREA'){
el.select();
document.execCommand('copy');
}else{
navigator.clipboard.writeText(el.innerText);
}
}

</script>
</body>
</html>