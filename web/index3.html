<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OG Slika i Naslov sa Proxy</title>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, button, select { padding: 10px; margin-top: 10px; width: 100%; box-sizing: border-box; }
    .loader { display: none; margin-top: 10px; }
    #result img { max-width: 100%; margin-top: 10px; border: 1px solid #ccc; }

    /* ✅ ZAJEDNIČKI STIL NASLOVA */
    #titleText {
      font-weight: bold;
      margin-top: 20px;
      text-align: center;
      word-break: break-word;
      overflow-wrap: break-word;
      white-space: normal;
      line-height: 1.2;

      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* ✅ TEME */
    .theme-dark {
      background: black;
    }
    .theme-dark #titleText {
      color: white;
    }

    .theme-light {
      background: white;
    }
    .theme-light #titleText {
      color: black;
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body>

<h2>OG Slika i Naslov sa Linka preko Proxy-a</h2>

<input type="text" id="urlInput" placeholder="Unesi URL (https://...)" />

<!-- ✅ IZBOR TEME -->
<select id="themeSelect">
  <option value="dark">Crna tema</option>
  <option value="light">Bijela tema</option>
</select>

<button id="generateBtn">Prikaži</button>
<div class="loader">⏳ Učitavanje...</div>

<div id="result" class="theme-dark" style="padding: 10px; border: 1px solid #ddd;">
  <img id="ogImage" src="" alt="OG Slika" style="display:none;" />
  <div id="titleText"></div>
</div>

<button id="screenshotBtn">Uzmi Screenshot</button>
<br /><br />

<img id="captured" alt="Snimak" style="border:1px solid #ccc; max-width:100%; display:none;" />
<a id="downloadBtn" href="#" download="screenshot.jpg" style="display:none;">
  <button>Sačuvaj sliku</button>
</a>

<script>
const proxyUrl = 'https://api.codetabs.com/v1/proxy?quest=';

/* ✅ PAMETNA VELIČINA FONTA */
function setTitleText(text) {
  const el = $("#titleText");
  el.text(text);

  if (text.length > 140) {
    el.css("font-size", "34px");
  } else if (text.length > 110) {
    el.css("font-size", "40px");
  } else if (text.length > 80) {
    el.css("font-size", "48px");
  } else {
    el.css("font-size", "60px");
  }
}

/* ✅ PROMJENA TEME */
$("#themeSelect").on("change", function () {
  const theme = $(this).val();
  $("#result")
    .removeClass("theme-dark theme-light")
    .addClass(theme === "dark" ? "theme-dark" : "theme-light");
});

$("#generateBtn").on("click", async function () {
  const url = $("#urlInput").val().trim();
  if (!url) return alert("Unesi URL.");
  $(".loader").show();

  try {
    const response = await fetch(proxyUrl + encodeURIComponent(url));
    const html = await response.text();

    const doc = new DOMParser().parseFromString(html, "text/html");

    const title = doc.querySelector('meta[property="og:title"]')?.content || "Nema naslova";
    const image = doc.querySelector('meta[property="og:image"]')?.content || "";

    setTitleText(title);

    if (image) {
      $("#ogImage").attr("src", proxyUrl + encodeURIComponent(image)).show();
    } else {
      $("#ogImage").hide();
    }

  } catch (e) {
    alert("Došlo je do greške.");
    console.error(e);
  } finally {
    $(".loader").hide();
  }
});

function getScreenshotOfElement(element, callback) {
  html2canvas(element, { useCORS: true, scale: 2 }).then(canvas => {
    callback(canvas.toDataURL("image/jpeg", 0.9));
  });
}

$("#screenshotBtn").on("click", function () {
  getScreenshotOfElement($("#result")[0], function (dataUrl) {
    $("#captured").attr("src", dataUrl).show();
    $("#downloadBtn").attr("href", dataUrl).show();
  });
});
</script>

</body>
</html>
